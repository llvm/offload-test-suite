#--- vertex.hlsl
struct Inner {
    float b : B;
};

struct VSInput {
    float4 position : POSITION;
};

struct VSOutput {
    float4 position : SV_POSITION;
    float a : A;
    Inner inner;
    float c : C;
};

VSOutput main(VSInput input) {
    VSOutput output;
    output.position = input.position;
    output.a = 0.25;
    output.inner.b = 0.5;
    output.c = 0.75;
    return output;
}

#--- pixel.hlsl
struct Inner {
    float b : B;
};

struct PSInput {
    float4 position : SV_POSITION;
    float a : A;
    Inner inner;
    float c : C;
};

float4 main(PSInput input) : SV_TARGET {
    return float4(input.a, input.inner.b, input.c, 1.0);
}

#--- pipeline.yaml
---
Shaders:
  - Stage: Vertex
    Entry: main
  - Stage: Pixel
    Entry: main
Buffers:
  - Name: VertexData
    Format: Float32
    Stride: 16
    Data: [  0.0,  3.0, 0.0, 1.0,
             3.0, -3.0, 0.0, 1.0,
            -3.0, -3.0, 0.0, 1.0 ]
  - Name: Output
    Format: Float32
    Channels: 4
    FillSize: 16 # 1x1 @ 16 bytes per pixel
    OutputProps:
      Height: 1
      Width: 1
      Depth: 16
Bindings:
  VertexBuffer: VertexData
  VertexAttributes:
    - Format: Float32
      Channels: 4
      Offset: 0
      Name: POSITION
  RenderTarget: Output
DescriptorSets: []
...
#--- end

# Semantics are not implemented in the DXIL backend.
# XFAIL: Clang && !Vulkan

# FIXME: Crashing, See https://github.com/llvm/llvm-project/issues/181674
# XFAIL: Clang

# RUN: split-file %s %t
# RUN: %dxc_target -T vs_6_0 -Fo %t-vertex.o %t/vertex.hlsl
# RUN: %dxc_target -T ps_6_0 -Fo %t-pixel.o %t/pixel.hlsl
# RUN: %offloader %t/pipeline.yaml %t-vertex.o %t-pixel.o | FileCheck %s

# CHECK: Data:
# CHECK: [ 0.25, 0.5, 0.75, 1 ]
