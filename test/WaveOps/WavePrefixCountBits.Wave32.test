#--- source.hlsl
RWStructuredBuffer<uint> Out1 : register(u1);
RWStructuredBuffer<uint> Out2 : register(u2);

[WaveSize(32)]
[numthreads(32, 1, 1)]
void main(uint3 tid : SV_GroupThreadID) {
  
  // this should be an ascending sequence of numbers
  Out1[tid.x] = WavePrefixCountBits(true);
  // this should look more like 1, 1, 2, 2, 3, 3, etc.
  Out2[tid.x] = WavePrefixCountBits(tid.x % 2 == 0);
}

//--- pipeline.yaml

---
Shaders:
  - Stage: Compute
    Entry: main
    DispatchSize: [1, 1, 1]
Buffers:  
  - Name: Out1
    Format: UInt32
    Stride: 4
    FillSize: 128
  - Name: ExpectedOut1
    Format: UInt32
    Stride: 4
    Data: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,
 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]

  - Name: Out2
    Format: UInt32
    Stride: 4
    FillSize: 128
  - Name: ExpectedOut2
    Format: UInt32
    Stride: 4
    Data: [0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8,
 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 14, 14, 15, 15, 16]
Results:
  - Result: Test1
    Rule: BufferExact
    Actual: Out1
    Expected: ExpectedOut1
  - Result: Test2
    Rule: BufferExact
    Actual: Out2
    Expected: ExpectedOut2
DescriptorSets:
  - Resources:    
    - Name: Out1
      Kind: RWStructuredBuffer
      DirectXBinding:
        Register: 1
        Space: 0
      VulkanBinding:
        Binding: 2
    - Name: Out2
      Kind: RWStructuredBuffer
      DirectXBinding:
        Register: 2
        Space: 0
      VulkanBinding:
        Binding: 2
...
#--- end

# REQUIRES: WaveSize_32

# RUN: split-file %s %t
# RUN: %dxc_target -T cs_6_6 -Fo %t.o %t/source.hlsl
# RUN: %offloader %t/pipeline.yaml %t.o
