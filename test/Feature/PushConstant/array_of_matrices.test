#--- source.hlsl
struct S {
  float2x2 mats[2];
};

[[vk::push_constant]] S buffer;

RWStructuredBuffer<float> output : register(u0);

[numthreads(1,1,1)]
void main() {
  // Matrix 0
  output[0] = buffer.mats[0]._m00;
  output[1] = buffer.mats[0]._m01;
  output[2] = buffer.mats[0]._m10;
  output[3] = buffer.mats[0]._m11;

  // Matrix 1
  output[4] = buffer.mats[1][0][0];
  output[5] = buffer.mats[1][0][1];
  output[6] = buffer.mats[1][1][0];
  output[7] = buffer.mats[1][1][1];
}
//--- pipeline.yaml
---
Shaders:
  - Stage: Compute
    Entry: main
    DispatchSize: [1, 1, 1]
Buffers:
  - Name: output
    Format: Float32
    Data: [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ]
PushConstants:
  - Stage: Compute
    Values:
    - Format: Float32
      Offset: 0
      # DXC emits RowMajor decoration. Each row is contiguous.
      #      0     1
      #   +-----+-----+
      # 0 | 1.0 | 2.0 |
      #   +-----+-----+
      # 1 | 3.0 | 4.0 |
      #   +-----+-----+
      #
      # HLSL access is MAT[ROW][COL]
      #   output[0] = row 0, col 0 = 1.0
      #   output[1] = row 0, col 1 = 2.0
      #   output[2] = row 1, col 1 = 3.0
      #   output[3] = row 1, col 1 = 4.0
      Data: [ 1.0, 2.0, 3.0, 4.0 ]
    - Format: Float32
      Offset: 16
      #      0     1
      #   +-----+-----+
      # 0 | 5.0 | 6.0 |
      #   +-----+-----+
      # 1 | 7.0 | 8.0 |
      #   +-----+-----+
      Data: [ 5.0, 6.0, 7.0, 8.0 ]
DescriptorSets:
  - Resources:
    - Name: output
      Kind: RWStructuredBuffer
      DirectXBinding:
        Register: 0
        Space: 0
      VulkanBinding:
        Binding: 0
...
#--- end
# UNSUPPORTED: Metal || DirectX
#
# FIXME: determine the row/col order?
# XFAIL: Clang || DXC

# RUN: split-file %s %t
# RUN: %dxc_target -T cs_6_0 -Fo %t.o %t/source.hlsl
# RUN: %offloader %t/pipeline.yaml %t.o | FileCheck %s

# CHECK: Name: output
# CHECK: Data: [
# CHECK: 1, 2,
# CHECK: 3, 4,
#
# CHECK: 5, 6,
# CHECK: 7, 8
# CHECK: ]
