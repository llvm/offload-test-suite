#--- source.hlsl
struct S {
  row_major float2x2 rm;
  column_major float2x2 cm;
};

[[vk::push_constant]] S buffer;

RWStructuredBuffer<float> output : register(u0);

[numthreads(1,1,1)]
void main() {
  // Row major: contiguous in memory is row.
  // rm[0][0], rm[0][1], rm[1][0], rm[1][1]
  output[0] = buffer.rm[0][0];
  output[1] = buffer.rm[0][1];
  output[2] = buffer.rm[1][0];
  output[3] = buffer.rm[1][1];

  // Column major: contiguous in memory is column.
  // cm[0][0], cm[1][0], cm[0][1], cm[1][1]
  output[4] = buffer.cm[0][0];
  output[5] = buffer.cm[0][1];
  output[6] = buffer.cm[1][0];
  output[7] = buffer.cm[1][1];
}
//--- pipeline.yaml
---
Shaders:
  - Stage: Compute
    Entry: main
    DispatchSize: [1, 1, 1]
Buffers:
  - Name: output
    Format: Float32
    Data: [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ]
PushConstants:
  - Stage: Compute
    Values:
    - Format: Float32
      Offset: 0
      # Row major input: Row 0 (1,2), Row 1 (3,4)
      # Memory: 1, 2, 3, 4
      Data: [ 1.0, 2.0, 3.0, 4.0 ]
    - Format: Float32
      Offset: 16
      # Column major input: Col 0 (5,6), Col 1 (7,8)
      # Memory: 5, 6, 7, 8
      Data: [ 5.0, 6.0, 7.0, 8.0 ]
DescriptorSets:
  - Resources:
    - Name: output
      Kind: RWStructuredBuffer
      DirectXBinding:
        Register: 0
        Space: 0
      VulkanBinding:
        Binding: 0
...
#--- end
# UNSUPPORTED: Metal || DirectX
#
# row_major & col_major not supported.
# XFAIL: Clang

# RUN: split-file %s %t
# RUN: %dxc_target -fvk-use-dx-layout -T cs_6_0 -Fo %t.o %t/source.hlsl
# RUN: %offloader %t/pipeline.yaml %t.o | FileCheck %s

# CHECK: Name: output
# CHECK: Data: [
# CHECK: 1,
# CHECK: 2,
# CHECK: 3,
# CHECK: 4,
# CHECK: 5,
# CHECK: 7,
# CHECK: 6,
# CHECK: 8
# CHECK: ]
