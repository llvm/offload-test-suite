#--- source.hlsl
struct S1 {
  float4 a[3];
};
struct S2 {
  float b[4][3];
};
struct X {
  S1 a;
  S2 b;
  float c[3][4];
};

StructuredBuffer<S1> In1 : register(t1);
StructuredBuffer<S2> In2 : register(t2);
StructuredBuffer<float[3][4]> In3 : register(t3);
RWStructuredBuffer<X> Out : register(u0);

[numthreads(1,1,1)]
void main(uint GI : SV_GroupIndex) {
  Out[GI].a = In1[GI];
  Out[GI].b = In2[GI];
  Out[GI].c = In3[GI];
}
//--- pipeline.yaml
---
Shaders:
  - Stage: Compute
    Entry: main
    DispatchSize: [1, 1, 1]
Buffers:
  - Name: Input
    Format: Float32
    Stride: 48
    Data: [
      1.0, 2.0, 3.0, 4.0,
      5.0, 6.0, 7.0, 8.0,
      9.0, 10.0, 11.0, 12.0,
    ]
  - Name: Output
    Format: Float32
    Stride: 144
    FillSize: 144
  - Name: ExpectedOutput
    Format: Float32
    Stride: 144
    Data: [
      1.0, 2.0, 3.0, 4.0,
      5.0, 6.0, 7.0, 8.0,
      9.0, 10.0, 11.0, 12.0,
      1.0, 2.0, 3.0, 4.0,
      5.0, 6.0, 7.0, 8.0,
      9.0, 10.0, 11.0, 12.0,
      1.0, 2.0, 3.0, 4.0,
      5.0, 6.0, 7.0, 8.0,
      9.0, 10.0, 11.0, 12.0,
    ]
Results:
  - Result: Test0
    Rule: BufferExact
    Actual: Output
    Expected: ExpectedOutput
DescriptorSets:
  - Resources:
    - Name: Input
      Kind: StructuredBuffer
      DirectXBinding:
        Register: 1
        Space: 0
      VulkanBinding:
        Binding: 1
    - Name: Input
      Kind: StructuredBuffer
      DirectXBinding:
        Register: 2
        Space: 0
      VulkanBinding:
        Binding: 2
    - Name: Input
      Kind: StructuredBuffer
      DirectXBinding:
        Register: 3
        Space: 0
      VulkanBinding:
        Binding: 3
    - Name: Output
      Kind: RWStructuredBuffer
      DirectXBinding:
        Register: 0
        Space: 0
      VulkanBinding:
        Binding: 0
...
#--- end

# Unimplemented https://github.com/llvm/llvm-project/issues/147352
# XFAIL: Clang

# RUN: split-file %s %t
# RUN: %dxc_target -T cs_6_4 -Fo %t.o %t/source.hlsl
# RUN: %offloader %t/pipeline.yaml %t.o
